<div class="row"><br/></div>
<div class="row">
  <div class="col-xs-5">
    <% unless @searchTitle.blank? and @searchPublisher.blank? %>
      <div>
        <span>
          <%= (@searchTitle.blank? ? "Games" : @searchTitle) +
                        (@searchPublisher.blank? ? "" : " by " + @searchPublisher) %>
        </span>
        <a href="<%= games_path %>"><i class="bi bi-x-lg"></i></a>
      </div>
    <% end %>
  </div>
  <div class="col-xs-6"></div>
</div>

<div class="row"><br/></div>

<table class="table table-striped">
  <tr>
    <th class="col-xs-1">
      Barcode
    </th>
    <th class="col-xs-3">
      Title
    </th>
    <th class="col-xs-2">
      Publisher
    </th>
    <th class="col-xs-2 input-icons" style="text-align: center;">
      Valuable
      <span
        class="bi bi-question-circle-fill"
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        data-bs-original-title="This field is a marker of whether a game is hard to replace,
            expensive, or likely used in tournaments."
      ></span>
    </th>
    <th class="col-xs-2" style="text-align: center;">
      Checked Out @
    </th>
    <th class="col-xs-2" style="text-align: center;">
      Loaned To
    </th>
  </tr>
  <% @games.each do |game| %>
    <tr>
      <td class="col-xs-1">
        <%= game.barcode %>
      </td>
      <td class="col-xs-3">
        <%= game.name %>
      </td>
      <td class="col-xs-2">
        <%= game.by %>
      </td>
      <td class="col-xs-2" style="text-align: center;">
        <% if game.valuable? %>
          <span>Yes</span>
        <% end %>
      </td>
      <td class="col-xs-2" style="text-align: center;">
        <% if game.checked_out? %>
          <%= ct(game.open_checkout.check_out_time).strftime('%m/%d %I:%M%P') %>
        <% end %>
      </td>
      <td class="col-xs-2" style="text-align: center;">
        <% if game.loaned? %>
          <a
            href="<%= group_path(game.current_loan.group) %>"
            class="text-decoration-none"
          >
            <%= game.current_loan.group.name %>
          </a>
        <% end %>
      </td>
    </tr>
  <% end %>
</table>

<div class="digg_pagination">
  <%= will_paginate @games %>
</div>

<% if @games.empty? %>
  <div class="row" style="text-align: center;">
    <b>No games found!</b>
    <div class="col-xs-12">
      <a id="suggestBtn" class="btn btn-outline-secondary" style="margin: 5px;">
        Suggest adding this title to the library?
      </a>
    </div>
  </div>
<% end %>

<script>
    $(function(){
        $('[data-h-tip]').pTip();

        $('#suggestBtn').click(function() {
            $.ajax({
                url: '/suggest',
                method: 'post',
                data: {title: "<%= (@searchTitle.blank? ? "Games" : @searchTitle) +
                        (@searchPublisher.blank? ? "" : " by " + @searchPublisher) %>"},
                success: function (response) {
                    if (response.title) {
                        $.notify('Thanks for suggesting "' + response.title + '"!');
                    }
                }
            })
        });
    });
</script>
